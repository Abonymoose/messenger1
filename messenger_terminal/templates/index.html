<!DOCTYPE html>
<html>
<head>
  <title>Terminal</title>
  <style>
    body { background:#000; color:#ff2b2b; font-family: monospace; margin:0; }
    #header { padding:10px; border-bottom:1px solid #ff2b2b; }
    #active { float:right; }
    #msgs { height:66vh; overflow-y:auto; padding:10px; white-space:pre-wrap;}
    #form { display:flex; border-top:1px solid #ff2b2b;}
    input{ background:#111; border:none; color:#ff2b2b; flex:1; padding:10px;}
    button{ background:#ff2b2b; border:none; color:#000; padding:10px;}
    #login { display:flex; padding:10px; gap:5px; background:#111; }
    #login input { flex:1; padding:10px; background:#000; border:1px solid #ff2b2b; color:#ff2b2b; }
  </style>
</head>
<body>
  <div id="header">TERMINAL <span id="active">Active: 0</span></div>
  <div id="msgs"></div>
  <div id="login">
    <input id="user" placeholder="username"><input id="pw" placeholder="password">
    <button id="enter">Enter</button>
  </div>
  <form id="form" style="display:none;">
    <input id="msg" placeholder="Type a command or message...">
    <button type="submit">Send</button>
  </form>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const sock = io();
    const msgs = document.getElementById("msgs"),
          form = document.getElementById("form"),
          login = document.getElementById("login"),
          enter = document.getElementById("enter"),
          user = document.getElementById("user"),
          pw = document.getElementById("pw"),
          msgIn = document.getElementById("msg"),
          active = document.getElementById("active");

    function updateActive(n){ active.textContent="Active: "+n; }

    enter.onclick = ()=> {
      if (!user.value) return;
      sock.emit("set_username", {username:user.value, password:pw.value});
      login.style.display="none"; form.style.display="flex";
    };
    form.onsubmit = e => {
      e.preventDefault();
      if (!msgIn.value) return;
      sock.emit("chat", {msg: msgIn.value});
      msgIn.value="";
    };
    sock.on("message", d=>{
      msgs.innerHTML += d.msg + "\n";
      msgs.scrollTop = msgs.scrollHeight;
    });
    sock.on("active_count", d=> updateActive(d.n));
  </script>
</body>
</html>
